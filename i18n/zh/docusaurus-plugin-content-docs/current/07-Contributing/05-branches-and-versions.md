---
sidebar_position: 5
---

# 分支与发版

## 一、分支名与版本号

- 我们使用[“语意化版本”](https://semver.org)规则来决定版本号；
- 我们只使用两类分支：
  - `main` 分支 -> 主分支、开发集成分支，所有的 pr 都合入 `main` 分支；
  - `release` 分支 -> 发版分支，引入 `release` 分支的主要目的是为了在非最新版本上发布补丁版本。

## 二、我们从哪个分支发版

由于历史原因，早期我们只维护了一个 `main` 分支，所以分支与版本的对应关系分为两种情况：

|     分支    | 版本号      |
| :---------: | :---------:|
|     main    | <= v0.4.0  |
| release-x.y | >= v0.5.0  |

## 三、分支名与版本号的对应关系

从 `v0.5.0` 版本开始，我们决定从特定的 `release` 分支发版。release 分支的命名规则是 `release-x.y`，对应版本 `vx.y.n`，n 在这里是 patch 版本号的意思。如下表：

|     分支    | 版本号      |
| :---------: | :---------:|
| release-0.5 | v0.5.0     |
| release-0.6 | v0.6.0, v0.6.1, ...  |

再举个例子：

- `release-0.5` 分支上发布的第一个版本对应版本号就是 `v0.5.0`；
- `v0.5.0` 版本上发现了 bug，这时候 bugfix 对应的 commit(s) 通过 `cherry-pick` 从 `main` 分支合入到 `release-0.5` 分支上，然后继续发布 `v0.5.1` 版本；

## 四、发版节奏

从 `v0.5.0` 版本开始，在 `v1.0` 版本之前，我们保持每个月发布一个小版本的节奏。比如这个月发布 `v0.5.0` 版本，那么下个月要发布的版本就是 `v0.6.0`。

## 五、版本维护时长

**在 `v1.0` 版本之前，我们只维护最新版本。**比如 `v0.5.0` 发布后，在 `v0.6.0` 发布之前，我们会将所有的 bugfix 通过 `cherry-pick` 的方式合入到 `release-0.5` 分支上，并且在 `release-0.5` 分支上持续发布 `v0.5.n` 补丁版本，当 `v0.6.0` 版本发布后，`release-0.5` 分支便不再更新。

**从 `v1.0` 版本开始，我们将切换为每三个月发布一次小版本，累计维护三个小版本。**也就是说每个小版本的维护周期是 **3 x 3 = 9** 个月。举个例子，假如 **2023 年 1 月**发布了 `v1.0.0` 版本，那么 `v1.1.0` 版本会在 **2023 年 4 月**发布，`v1.2.0` 版本会在 **2023 年 7 月**发布。每个小版本发布后的 **9** 个月时间内都会持续合入 bugfix 代码，持续发布相应的补丁版本。
